# ë…¼ë¬¸ vs ì½”ë“œ ëª¨ìˆœì  ë¶„ì„ ë³´ê³ ì„œ

**ì‘ì„±ì¼**: 2025-11-26  
**ë¶„ì„ ëŒ€ìƒ**: `experiments/core/` í´ë” ë‚´ í•µì‹¬ ëª¨ë“ˆ

---

## ìš”ì•½

ë…¼ë¬¸ê³¼ ì‹¤ì œ êµ¬í˜„ ì½”ë“œ ê°„ **7ê°œì˜ ì£¼ìš” ëª¨ìˆœì **ê³¼ **4ê°œì˜ ê²½ë¯¸í•œ ë¶ˆì¼ì¹˜**ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ”´ ì£¼ìš” ëª¨ìˆœì  (Critical Discrepancies)

### 1. Volatility ê³„ì‚° ë°©ì‹ ë¶ˆì¼ì¹˜

| í•­ëª© | ë…¼ë¬¸ | ì½”ë“œ |
|------|------|------|
| **ë°©ì‹** | ìµœê·¼ **8ì£¼**ì˜ median relative change | ìµœê·¼ **ì „ì²´ recent_values**ì˜ median (ê¸¸ì´ ê°€ë³€) |
| **ë²”ìœ„** | [0.05, 0.50] í´ë¨í•‘ | í´ë¨í•‘ **ì—†ìŒ** |

**ë…¼ë¬¸ (Section 3.2.1)**:
> Volatility is computed as the **median of recent weekly relative changes over the last eight weeks**, with its range **clipped to [0.05, 0.50]**

**ì½”ë“œ** (`simple_forecast_generator.py` L429-435):
```python
def _compute_volatility(self, recent_values: List[float]) -> float:
    if len(recent_values) < 2:
        return 0.15
    arr = np.array(recent_values, dtype=float)
    deltas = np.abs(np.diff(arr))
    baseline = np.maximum(1.0, arr[:-1])
    pct = deltas / baseline
    return float(np.median(pct) if pct.size else 0.15)  # í´ë¨í•‘ ì—†ìŒ!
```

**ìˆ˜ì • í•„ìš”**: ì½”ë“œì— `max(0.05, min(0.50, ...))` í´ë¨í•‘ ì¶”ê°€ í•„ìš”

---

### 2. Quantile ìƒì„± ë°©ì‹ ë¶ˆì¼ì¹˜

| í•­ëª© | ë…¼ë¬¸ | ì½”ë“œ |
|------|------|------|
| **ë¶„í¬** | Negative Binomial **inverse CDF** | Normal approximation (z-score) |
| **íŒŒë¼ë¯¸í„°** | $n = \mu^2/(\sigma^2 - \mu)$, $p = n/(n+\mu)$ | Var = m + overdisp Ã— mÂ², std, z=1.645 |

**ë…¼ë¬¸ (Section 3.2.3)**:
> The 90% prediction interval is obtained from the **inverse cumulative distribution function (inverse CDF)** of the negative binomial:
> $Q_{05} = F^{-1}_{NB}(0.05; n, p)$

**ì½”ë“œ** (`simple_forecast_generator.py` L400-414):
```python
def _neg_binom_quantiles(self, mean: float, overdisp: float, alpha: float = 0.05):
    z = 1.645  # Normal approximation!
    var = m + overdisp * (m ** 2)
    std = math.sqrt(max(var, 1e-6))
    q05 = max(0.0, m - z * std)  # ì •ê·œë¶„í¬ ê·¼ì‚¬
    q95 = m + z * std
    return q05, q50, q95
```

**ë¬¸ì œì **: ë…¼ë¬¸ì€ NBì˜ ì •í™•í•œ inverse CDFë¥¼ ì‚¬ìš©í•œë‹¤ê³  ì£¼ì¥í•˜ì§€ë§Œ, ì½”ë“œëŠ” **ì •ê·œë¶„í¬ ê·¼ì‚¬**ë¥¼ ì‚¬ìš©. íŠ¹íˆ ì‘ì€ countì—ì„œ ë¶„í¬ì˜ ë¹„ëŒ€ì¹­ì„±ì´ ë¬´ì‹œë¨.

---

### 3. Variance ê³µì‹ ë¶ˆì¼ì¹˜

| í•­ëª© | ë…¼ë¬¸ | ì½”ë“œ |
|------|------|------|
| **ê³µì‹** | $\sigma^2 = (\mu \cdot v \cdot (1 + u))^2$ | $\text{var} = m + \text{overdisp} \times m^2$ |

**ë…¼ë¬¸ (Section 3.2.3)**:
> $\sigma^2 = (\hat{y}_{t+k} \cdot v \cdot (1 + u_{t+k}))^2$

**ì½”ë“œ**:
```python
# L254-255: dispersion ê³„ì‚°
dispersion = max(0.25, min(3.0, (0.5 + 2.5 * unc) * (0.5 + 2.0 * base_vol)))

# L408: variance ê³„ì‚°
var = m + overdisp * (m ** 2)  # NB standard form
```

**ë¬¸ì œì **: ë…¼ë¬¸ì˜ variance ê³µì‹ê³¼ ì½”ë“œì˜ ê³µì‹ì´ **ì™„ì „íˆ ë‹¤ë¦„**. ë…¼ë¬¸ì€ $(\mu \cdot v \cdot (1+u))^2$ì´ê³ , ì½”ë“œëŠ” NB í‘œì¤€ í˜•íƒœ $\mu + \alpha\mu^2$.

---

### 4. Growth Rate ê³„ì‚° ê¸°ê°„ ë¶ˆì¼ì¹˜

| í•­ëª© | ë…¼ë¬¸ | ì½”ë“œ |
|------|------|------|
| **ê¸°ê°„** | **4ì£¼** ì°¨ì´ | ì¡°ê±´ë¶€: 4ì£¼ ë˜ëŠ” ì „ì²´ ê¸°ê°„ |

**ë…¼ë¬¸ (Section 3.1.3)**:
> $g_t = \frac{y_t - y_{t-4}}{\max(1.0, y_{t-4})}$

**ì½”ë“œ** (`simple_forecast_generator.py` L437-443):
```python
def _compute_trend(self, recent_values: List[float]) -> Dict[str, float]:
    if len(arr) >= 4:
        growth_rate = (arr[-1] - arr[-4]) / max(1.0, arr[-4])
    else:
        growth_rate = (arr[-1] - arr[0]) / max(1.0, arr[0])  # fallback
```

**ë¬¸ì œì **: 4ì£¼ ë¯¸ë§Œì¼ ë•Œì˜ fallback ë™ì‘ì´ ë…¼ë¬¸ì— ê¸°ìˆ ë˜ì§€ ì•ŠìŒ.

---

### 5. RAG Query êµ¬ì„± ë°©ì‹ ì°¨ì´

| í•­ëª© | ë…¼ë¬¸ | ì½”ë“œ |
|------|------|------|
| **ì¿¼ë¦¬** | ê³„ì ˆ, í™˜ê²½, ì‚¬íšŒì  ìš”ì¸ì— ë”°ë¼ **ë™ì  êµ¬ì„±** | **í•˜ë“œì½”ë”©ëœ ê³ ì • ì¿¼ë¦¬** |
| **top-k** | k=2 | k=3 |
| **max_length** | 1200 chars | 1500 chars |

**ë…¼ë¬¸ (Section 3.1.2)**:
> For seasonal factors, the query includes terms such as "HFMD peak season spring summer" during Mayâ€“July...
> ...top-$k$ ($k=2$) most relevant guideline passages (up to 1200 characters)

**ì½”ë“œ** (`simple_event_interpreter.py` L117-118):
```python
query = f"HFMD transmission seasonality school calendar weather around {train_until}"
guideline_ctx = rag.get_context_for_prompt(query, k=3, max_length=1500)
```

**ë¬¸ì œì **: ë…¼ë¬¸ì€ ê³„ì ˆ/í™˜ê²½/ì‚¬íšŒ ìš”ì¸ì— ë”°ë¼ ì¿¼ë¦¬ë¥¼ ë™ì ìœ¼ë¡œ êµ¬ì„±í•œë‹¤ê³  í–ˆìœ¼ë‚˜, ì½”ë“œëŠ” **í•­ìƒ ë™ì¼í•œ ì¿¼ë¦¬** ì‚¬ìš©.

---

### 6. ì…ë ¥ ë°ì´í„° í•­ëª© ë¶ˆì¼ì¹˜

| í•­ëª© | ë…¼ë¬¸ | ì½”ë“œ |
|------|------|------|
| **í•™êµ ìº˜ë¦°ë”** | êµ¬ì²´ì  categorical (in_session, summer_break, winter_break) | ë‹¨ìˆœí™”: 7-8ì›”ë§Œ ë°©í•™ |
| **ê³µíœ´ì¼** | Spring Festival, National Day ë“± | êµ¬í˜„ ì—†ìŒ |
| **ë‚ ì”¨ ì§‘ê³„** | ì£¼ê°„ ìš”ì•½ (7-day) | ìµœê·¼ 7ì¼ daily records |

**ë…¼ë¬¸ (Section 3.1.1)**:
> Each epidemiological week is labeled with the corresponding school status (e.g., `in_session`, `summer_break`, `winter_break`) and public holidays (e.g., Spring Festival, National Day).

**ì½”ë“œ** (`rolling_agent_forecast.py` L262-267):
```python
# ì•„ì£¼ ê°„ë‹¨í•œ school calendar: 7-8ì›”ë§Œ ë°©í•™
month = target_date.month
if month in (7, 8):
    school_status = "summer_break"
else:
    school_status = "term_in_session"
# ê³µíœ´ì¼: ì—†ìŒ!
```

**ë¬¸ì œì **: ê²¨ìš¸ë°©í•™, ì¶˜ì ˆ, êµ­ê²½ì¼ ë“±ì´ **ì „í˜€ êµ¬í˜„ë˜ì§€ ì•ŠìŒ**.

---

### 7. Temperature ì„¤ì • ë¶ˆì¼ì¹˜

| í•­ëª© | ë…¼ë¬¸ | ì½”ë“œ |
|------|------|------|
| **ê°’** | 0.6 | 0.2 (ê¸°ë³¸ê°’), ê°€ë³€ |

**ë…¼ë¬¸ (Section 3.1.4)**:
> The temperature is set to **0.6** to allow moderate creativity while limiting hallucinations.

**ì½”ë“œ** (`simple_event_interpreter.py` L86, `simple_forecast_generator.py` L108):
```python
temperature: float = 0.2,  # ê¸°ë³¸ê°’
```

**ë¬¸ì œì **: ë…¼ë¬¸ì€ 0.6ì„ ì‚¬ìš©í•œë‹¤ê³  í–ˆìœ¼ë‚˜ ì½”ë“œ ê¸°ë³¸ê°’ì€ 0.2.

---

## ğŸŸ¡ ê²½ë¯¸í•œ ë¶ˆì¼ì¹˜ (Minor Discrepancies)

### A. Consecutive Growth ê³„ì‚°

**ë…¼ë¬¸**: "weeks_growing"ì´ ì—°ì† ìƒìŠ¹ ì£¼ ìˆ˜ì˜ **ìµœëŒ€ê°’**  
**ì½”ë“œ**: ë‹¨ìˆœíˆ í˜„ì¬ ì‹œì ë¶€í„° ì—­ìˆœìœ¼ë¡œ counting (ë…¼ë¬¸ ì •ì˜ì™€ ë™ì¼í•˜ë‚˜ ëª…ì¹­ ì°¨ì´)

---

### B. ë°ì´í„°ì…‹ ê¸°ê°„ ì„œìˆ 

**ë…¼ë¬¸**: Lishui hospital datasetì„ 2023-01-09 ~ 2024-01-29 í•™ìŠµ, 2024-02-01 ~ 2024-09-30 í‰ê°€  
**ì½”ë“œ ì‹¤í—˜**: 2024-02-01ë¶€í„° í‰ê°€ (ì¼ì¹˜)

â†’ ì´ ë¶€ë¶„ì€ **ì¼ì¹˜í•¨**

---

### C. Embedding ëª¨ë¸

**ë…¼ë¬¸**: `all-MiniLM-L6-v2`  
**ì½”ë“œ**: HuggingFaceEmbeddings (ê¸°ë³¸ê°’ì´ MiniLMì¼ ê°€ëŠ¥ì„± ë†’ìŒ, ëª…ì‹œì  í™•ì¸ í•„ìš”)

---

### D. Peak Status ê³„ì‚°

**ë…¼ë¬¸**: 90th percentile ì´ˆê³¼ ì‹œ is_at_peak=1  
**ì½”ë“œ**: ì´ ê¸°ëŠ¥ì´ **ëª…ì‹œì ìœ¼ë¡œ êµ¬í˜„ë˜ì–´ ìˆì§€ ì•ŠìŒ** (trend ê³„ì‚°ì—ë§Œ ì˜ì¡´)

---

## ğŸ“‹ ìˆ˜ì • ê¶Œì¥ ì‚¬í•­

| ìš°ì„ ìˆœìœ„ | í•­ëª© | ìˆ˜ì • ë‚´ìš© |
|----------|------|-----------|
| ğŸ”´ High | Volatility í´ë¨í•‘ | `_compute_volatility`ì— [0.05, 0.50] í´ë¨í•‘ ì¶”ê°€ |
| ğŸ”´ High | Quantile ìƒì„± | scipy.stats.nbinom.ppf ì‚¬ìš©í•˜ì—¬ ì •í™•í•œ inverse CDF êµ¬í˜„ |
| ğŸ”´ High | Variance ê³µì‹ | ë…¼ë¬¸ ê³µì‹ $(\mu \cdot v \cdot (1+u))^2$ìœ¼ë¡œ ìˆ˜ì • ë˜ëŠ” ë…¼ë¬¸ ìˆ˜ì • |
| ğŸŸ¡ Medium | RAG Query | ê³„ì ˆ/ë‚ ì”¨ì— ë”°ë¥¸ ë™ì  ì¿¼ë¦¬ êµ¬ì„± |
| ğŸŸ¡ Medium | School Calendar | ê²¨ìš¸ë°©í•™, ê³µíœ´ì¼ ë¡œì§ ì¶”ê°€ |
| ğŸŸ¢ Low | Temperature | ê¸°ë³¸ê°’ 0.6ìœ¼ë¡œ ë³€ê²½ ë˜ëŠ” ë…¼ë¬¸ ìˆ˜ì • |
| ğŸŸ¢ Low | Peak Status | is_at_peak ê³„ì‚° ë¡œì§ ì¶”ê°€ |

---

## ê²°ë¡ 

**ê°€ì¥ ì‹¬ê°í•œ ë¬¸ì œ**ëŠ” **Quantile ìƒì„± ë°©ì‹**ì…ë‹ˆë‹¤. ë…¼ë¬¸ì€ Negative Binomialì˜ ì •í™•í•œ inverse CDFë¥¼ ì‚¬ìš©í•œë‹¤ê³  ì£¼ì¥í•˜ì§€ë§Œ, ì‹¤ì œ ì½”ë“œëŠ” ì •ê·œë¶„í¬ ê·¼ì‚¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ëŠ” íŠ¹íˆ ë‚®ì€ count (< 10)ì—ì„œ ì˜ˆì¸¡ êµ¬ê°„ì˜ ë¹„ëŒ€ì¹­ì„±ì„ ì™œê³¡í•©ë‹ˆë‹¤.

ë‘ ë²ˆì§¸ë¡œ ì‹¬ê°í•œ ë¬¸ì œëŠ” **Variance ê³µì‹**ì˜ ë¶ˆì¼ì¹˜ë¡œ, ë…¼ë¬¸ê³¼ ì½”ë“œê°€ ì™„ì „íˆ ë‹¤ë¥¸ ê³µì‹ì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.

**ê¶Œì¥**: 
1. ì½”ë“œë¥¼ ë…¼ë¬¸ì— ë§ê²Œ ìˆ˜ì •í•˜ê±°ë‚˜
2. ë…¼ë¬¸ì˜ Methods ì„¹ì…˜ì„ ì½”ë“œ êµ¬í˜„ì— ë§ê²Œ ìˆ˜ì •

ë‘˜ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.
